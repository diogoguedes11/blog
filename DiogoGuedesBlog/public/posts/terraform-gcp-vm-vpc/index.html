<!doctype html><html lang=en dir=auto><head><script src="/gh-deployment-workflow-/livereload.js?mindelay=10&amp;v=2&amp;port=1314&amp;path=gh-deployment-workflow-/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploy Your First VM and VPC in Google Cloud with Terraform | Diogo Guedes | DevOps Engineer</title><meta name=keywords content="terraform,gcp,google-cloud,infrastructure-as-code,vpc,virtual-machine,devops"><meta name=description content="Complete guide to deploying your first virtual machine and VPC in Google Cloud Platform using Terraform infrastructure as code"><meta name=author content="Diogo Guedes"><link rel=canonical href=http://localhost:1314/gh-deployment-workflow-/posts/terraform-gcp-vm-vpc/><link crossorigin=anonymous href=/gh-deployment-workflow-/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1314/gh-deployment-workflow-/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1314/gh-deployment-workflow-/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1314/gh-deployment-workflow-/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1314/gh-deployment-workflow-/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1314/gh-deployment-workflow-/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1314/gh-deployment-workflow-/posts/terraform-gcp-vm-vpc/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1314/gh-deployment-workflow-/posts/terraform-gcp-vm-vpc/"><meta property="og:site_name" content="Diogo Guedes | DevOps Engineer"><meta property="og:title" content="Deploy Your First VM and VPC in Google Cloud with Terraform"><meta property="og:description" content="Complete guide to deploying your first virtual machine and VPC in Google Cloud Platform using Terraform infrastructure as code"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-29T15:00:00+00:00"><meta property="article:modified_time" content="2025-06-29T15:00:00+00:00"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="Gcp"><meta property="article:tag" content="Google-Cloud"><meta property="article:tag" content="Infrastructure-as-Code"><meta property="article:tag" content="Vpc"><meta property="article:tag" content="Virtual-Machine"><meta property="og:image" content="https://diogoguedes11.github.io/gh-deployment-workflow-/og-image.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://diogoguedes11.github.io/gh-deployment-workflow-/og-image.jpg"><meta name=twitter:title content="Deploy Your First VM and VPC in Google Cloud with Terraform"><meta name=twitter:description content="Complete guide to deploying your first virtual machine and VPC in Google Cloud Platform using Terraform infrastructure as code"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1314/gh-deployment-workflow-/posts/"},{"@type":"ListItem","position":2,"name":"Deploy Your First VM and VPC in Google Cloud with Terraform","item":"http://localhost:1314/gh-deployment-workflow-/posts/terraform-gcp-vm-vpc/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploy Your First VM and VPC in Google Cloud with Terraform","name":"Deploy Your First VM and VPC in Google Cloud with Terraform","description":"Complete guide to deploying your first virtual machine and VPC in Google Cloud Platform using Terraform infrastructure as code","keywords":["terraform","gcp","google-cloud","infrastructure-as-code","vpc","virtual-machine","devops"],"articleBody":"Google Cloud Platform (GCP) is one of the leading cloud providers, and Terraform is the de facto standard for Infrastructure as Code (IaC). In this comprehensive guide, you’ll learn how to deploy your first virtual machine and VPC in GCP using Terraform.\nPrerequisites Before we begin, make sure you have:\nGoogle Cloud Account with billing enabled Terraform installed (v1.0+) Google Cloud SDK (gcloud) installed and configured Basic understanding of cloud networking concepts Setting Up Your Environment 1. Install Required Tools 1 2 3 4 5 6 7 8 9 # Install Terraform (macOS with Homebrew) brew install terraform # Install Google Cloud SDK brew install --cask google-cloud-sdk # Verify installations terraform version gcloud version 2. Authenticate with Google Cloud 1 2 3 4 5 6 7 8 9 # Login to your Google Cloud account gcloud auth login # Set your default project gcloud config set project YOUR_PROJECT_ID # Enable required APIs gcloud services enable compute.googleapis.com gcloud services enable servicenetworking.googleapis.com 3. Create Service Account for Terraform 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Create service account gcloud iam service-accounts create terraform-sa \\ --display-name=\"Terraform Service Account\" # Grant necessary permissions gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \\ --member=\"serviceAccount:terraform-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com\" \\ --role=\"roles/compute.admin\" gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \\ --member=\"serviceAccount:terraform-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com\" \\ --role=\"roles/iam.serviceAccountUser\" # Create and download key gcloud iam service-accounts keys create terraform-key.json \\ --iam-account=terraform-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com Project Structure Let’s organize our Terraform code properly:\n1 2 3 4 5 6 terraform-gcp-vm/ ├── main.tf # Main configuration ├── variables.tf # Input variables ├── outputs.tf # Output values ├── terraform.tfvars # Variable values └── terraform-key.json # Service account key Creating the Terraform Configuration 1. Provider Configuration (main.tf) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 terraform { required_version = \"\u003e= 1.0\" required_providers { google = { source = \"hashicorp/google\" version = \"~\u003e 5.0\" } } } provider \"google\" { credentials = file(\"terraform-key.json\") project = var.project_id region = var.region zone = var.zone } # Create VPC Network resource \"google_compute_network\" \"vpc_network\" { name = var.network_name auto_create_subnetworks = false description = \"Custom VPC network for VM deployment\" } # Create Subnet resource \"google_compute_subnetwork\" \"subnet\" { name = var.subnet_name ip_cidr_range = var.subnet_cidr region = var.region network = google_compute_network.vpc_network.id description = \"Subnet for VM instances\" # Enable private Google access private_ip_google_access = true } # Create Firewall Rules resource \"google_compute_firewall\" \"allow_ssh\" { name = \"${var.network_name}-allow-ssh\" network = google_compute_network.vpc_network.name allow { protocol = \"tcp\" ports = [\"22\"] } source_ranges = [\"0.0.0.0/0\"] target_tags = [\"ssh-allowed\"] description = \"Allow SSH access from anywhere\" } resource \"google_compute_firewall\" \"allow_http\" { name = \"${var.network_name}-allow-http\" network = google_compute_network.vpc_network.name allow { protocol = \"tcp\" ports = [\"80\", \"443\"] } source_ranges = [\"0.0.0.0/0\"] target_tags = [\"web-server\"] description = \"Allow HTTP and HTTPS traffic\" } resource \"google_compute_firewall\" \"allow_internal\" { name = \"${var.network_name}-allow-internal\" network = google_compute_network.vpc_network.name allow { protocol = \"tcp\" ports = [\"0-65535\"] } allow { protocol = \"udp\" ports = [\"0-65535\"] } allow { protocol = \"icmp\" } source_ranges = [var.subnet_cidr] description = \"Allow internal communication within the subnet\" } # Create External IP resource \"google_compute_address\" \"static_ip\" { name = \"${var.vm_name}-static-ip\" region = var.region description = \"Static external IP for VM\" } # Create VM Instance resource \"google_compute_instance\" \"vm_instance\" { name = var.vm_name machine_type = var.machine_type zone = var.zone tags = [\"ssh-allowed\", \"web-server\"] boot_disk { initialize_params { image = var.vm_image size = var.disk_size type = \"pd-standard\" } } network_interface { network = google_compute_network.vpc_network.id subnetwork = google_compute_subnetwork.subnet.id access_config { nat_ip = google_compute_address.static_ip.address } } metadata = { ssh-keys = \"${var.ssh_username}:${file(var.ssh_public_key_path)}\" } metadata_startup_script = \u003c\u003c-EOF #!/bin/bash apt-get update apt-get install -y nginx systemctl start nginx systemctl enable nginx echo \"Hello from ${var.vm_name}!\" \u003e /var/www/html/index.html echo \"Deployed with Terraform on GCP\n\" \u003e\u003e /var/www/html/index.html EOF service_account { email = google_service_account.vm_service_account.email scopes = [\"cloud-platform\"] } labels = { environment = var.environment managed_by = \"terraform\" } } # Create Service Account for VM resource \"google_service_account\" \"vm_service_account\" { account_id = \"${var.vm_name}-sa\" display_name = \"Service Account for ${var.vm_name}\" description = \"Service account for VM instance\" } # IAM binding for VM service account resource \"google_project_iam_member\" \"vm_service_account_binding\" { project = var.project_id role = \"roles/compute.osLogin\" member = \"serviceAccount:${google_service_account.vm_service_account.email}\" } 2. Variables (variables.tf) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 variable \"project_id\" { description = \"GCP Project ID\" type = string } variable \"region\" { description = \"GCP Region\" type = string default = \"us-central1\" } variable \"zone\" { description = \"GCP Zone\" type = string default = \"us-central1-a\" } variable \"network_name\" { description = \"Name of the VPC network\" type = string default = \"my-vpc-network\" } variable \"subnet_name\" { description = \"Name of the subnet\" type = string default = \"my-subnet\" } variable \"subnet_cidr\" { description = \"CIDR range for the subnet\" type = string default = \"10.0.1.0/24\" } variable \"vm_name\" { description = \"Name of the VM instance\" type = string default = \"my-vm-instance\" } variable \"machine_type\" { description = \"Machine type for the VM\" type = string default = \"e2-micro\" } variable \"vm_image\" { description = \"Image for the VM\" type = string default = \"ubuntu-os-cloud/ubuntu-2204-lts\" } variable \"disk_size\" { description = \"Size of the boot disk in GB\" type = number default = 20 } variable \"ssh_username\" { description = \"SSH username\" type = string default = \"terraform-user\" } variable \"ssh_public_key_path\" { description = \"Path to SSH public key\" type = string default = \"~/.ssh/id_rsa.pub\" } variable \"environment\" { description = \"Environment tag\" type = string default = \"development\" } 3. Outputs (outputs.tf) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 output \"vpc_network_name\" { description = \"Name of the VPC network\" value = google_compute_network.vpc_network.name } output \"vpc_network_id\" { description = \"ID of the VPC network\" value = google_compute_network.vpc_network.id } output \"subnet_name\" { description = \"Name of the subnet\" value = google_compute_subnetwork.subnet.name } output \"subnet_cidr\" { description = \"CIDR range of the subnet\" value = google_compute_subnetwork.subnet.ip_cidr_range } output \"vm_name\" { description = \"Name of the VM instance\" value = google_compute_instance.vm_instance.name } output \"vm_internal_ip\" { description = \"Internal IP address of the VM\" value = google_compute_instance.vm_instance.network_interface[0].network_ip } output \"vm_external_ip\" { description = \"External IP address of the VM\" value = google_compute_address.static_ip.address } output \"ssh_connection_command\" { description = \"SSH command to connect to the VM\" value = \"ssh ${var.ssh_username}@${google_compute_address.static_ip.address}\" } output \"web_url\" { description = \"URL to access the web server\" value = \"http://${google_compute_address.static_ip.address}\" } 4. Variable Values (terraform.tfvars) 1 2 3 4 5 6 7 8 9 10 11 project_id = \"your-gcp-project-id\" region = \"us-central1\" zone = \"us-central1-a\" network_name = \"terraform-vpc\" subnet_name = \"terraform-subnet\" subnet_cidr = \"10.0.1.0/24\" vm_name = \"terraform-vm\" machine_type = \"e2-micro\" ssh_username = \"terraform-user\" ssh_public_key_path = \"~/.ssh/id_rsa.pub\" environment = \"development\" Deploying the Infrastructure 1. Generate SSH Key Pair 1 2 # Generate SSH key pair if you don't have one ssh-keygen -t rsa -b 4096 -C \"your-email@example.com\" 2. Initialize and Deploy 1 2 3 4 5 6 7 8 9 10 11 # Initialize Terraform terraform init # Validate configuration terraform validate # Plan the deployment terraform plan # Apply the configuration terraform apply 3. Verify Deployment 1 2 3 4 5 6 7 8 # Check the outputs terraform output # SSH into the VM ssh terraform-user@$(terraform output -raw vm_external_ip) # Test the web server curl http://$(terraform output -raw vm_external_ip) Best Practices 1. Security Considerations 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Use more restrictive firewall rules resource \"google_compute_firewall\" \"allow_ssh_restricted\" { name = \"${var.network_name}-allow-ssh-restricted\" network = google_compute_network.vpc_network.name allow { protocol = \"tcp\" ports = [\"22\"] } # Restrict to your IP address source_ranges = [\"YOUR_IP_ADDRESS/32\"] target_tags = [\"ssh-allowed\"] } 2. State Management 1 2 3 4 5 6 terraform { backend \"gcs\" { bucket = \"your-terraform-state-bucket\" prefix = \"terraform/state\" } } 3. Resource Tagging 1 2 3 4 5 6 7 8 9 10 11 12 13 14 locals { common_labels = { environment = var.environment project = \"terraform-gcp-demo\" managed_by = \"terraform\" created_by = \"diogo-guedes\" } } resource \"google_compute_instance\" \"vm_instance\" { # ... other configuration ... labels = local.common_labels } Advanced Configurations Multiple VMs with Load Balancer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # Instance Template resource \"google_compute_instance_template\" \"web_template\" { name_prefix = \"web-template-\" machine_type = var.machine_type disk { source_image = var.vm_image auto_delete = true boot = true } network_interface { network = google_compute_network.vpc_network.id subnetwork = google_compute_subnetwork.subnet.id } metadata_startup_script = file(\"startup-script.sh\") lifecycle { create_before_destroy = true } } # Managed Instance Group resource \"google_compute_instance_group_manager\" \"web_igm\" { name = \"web-igm\" base_instance_name = \"web\" zone = var.zone target_size = 2 version { instance_template = google_compute_instance_template.web_template.id } } Cleanup When you’re done testing, clean up the resources:\n1 2 3 4 # Destroy all resources terraform destroy # Confirm by typing 'yes' Troubleshooting Common Issues Authentication Errors\n1 2 # Re-authenticate gcloud auth application-default login API Not Enabled\n1 2 # Enable required APIs gcloud services enable compute.googleapis.com Insufficient Permissions\n1 2 # Check your permissions gcloud projects get-iam-policy YOUR_PROJECT_ID Cost Optimization Use e2-micro instances for testing (eligible for free tier) Set up budget alerts in GCP Console Use preemptible instances for non-critical workloads Implement auto-shutdown for development environments Conclusion You’ve successfully deployed your first virtual machine and VPC in Google Cloud Platform using Terraform! This foundation gives you:\nReproducible Infrastructure - Deploy identical environments Version Control - Track infrastructure changes Collaboration - Share infrastructure code with your team Scalability - Easily add more resources Next Steps Explore Terraform modules for reusable components Implement CI/CD pipelines for infrastructure deployment Learn about GCP networking features like Cloud NAT and VPN Set up monitoring and logging with Cloud Operations Resources Terraform GCP Provider Documentation Google Cloud Architecture Center Terraform Best Practices GCP Free Tier Happy terraforming! 🚀\nHave questions or suggestions? Feel free to reach out on LinkedIn or check out more DevOps content on this blog!\n","wordCount":"1881","inLanguage":"en","image":"https://diogoguedes11.github.io/gh-deployment-workflow-/og-image.jpg","datePublished":"2025-06-29T15:00:00Z","dateModified":"2025-06-29T15:00:00Z","author":{"@type":"Person","name":"Diogo Guedes"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1314/gh-deployment-workflow-/posts/terraform-gcp-vm-vpc/"},"publisher":{"@type":"Organization","name":"Diogo Guedes | DevOps Engineer","logo":{"@type":"ImageObject","url":"http://localhost:1314/gh-deployment-workflow-/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1314/gh-deployment-workflow-/ accesskey=h title="🚀 Diogo Guedes (Alt + H)">🚀 Diogo Guedes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1314/gh-deployment-workflow-/posts/ title="📝 Posts"><span>📝 Posts</span></a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/categories/ title="📂 Categories"><span>📂 Categories</span></a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/ title="🏷️ Tags"><span>🏷️ Tags</span></a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/archives/ title="📚 Archives"><span>📚 Archives</span></a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/about/ title="👤 About"><span>👤 About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1314/gh-deployment-workflow-/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1314/gh-deployment-workflow-/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Deploy Your First VM and VPC in Google Cloud with Terraform</h1><div class=post-description>Complete guide to deploying your first virtual machine and VPC in Google Cloud Platform using Terraform infrastructure as code</div><div class=post-meta><span title='2025-06-29 15:00:00 +0000 +0000'>June 29, 2025</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1881 words&nbsp;·&nbsp;Diogo Guedes&nbsp;|&nbsp;<a href=https://github.com/diogoguedes11/gh-deployment-workflow-/edit/main/DiogoGuedesBlog/content/posts/terraform-gcp-vm-vpc.md rel="noopener noreferrer edit" target=_blank>📝 Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#setting-up-your-environment>Setting Up Your Environment</a><ul><li><a href=#1-install-required-tools>1. Install Required Tools</a></li><li><a href=#2-authenticate-with-google-cloud>2. Authenticate with Google Cloud</a></li><li><a href=#3-create-service-account-for-terraform>3. Create Service Account for Terraform</a></li></ul></li><li><a href=#project-structure>Project Structure</a></li><li><a href=#creating-the-terraform-configuration>Creating the Terraform Configuration</a><ul><li><a href=#1-provider-configuration-maintf>1. Provider Configuration (<code>main.tf</code>)</a></li><li><a href=#2-variables-variablestf>2. Variables (<code>variables.tf</code>)</a></li><li><a href=#3-outputs-outputstf>3. Outputs (<code>outputs.tf</code>)</a></li><li><a href=#4-variable-values-terraformtfvars>4. Variable Values (<code>terraform.tfvars</code>)</a></li></ul></li><li><a href=#deploying-the-infrastructure>Deploying the Infrastructure</a><ul><li><a href=#1-generate-ssh-key-pair>1. Generate SSH Key Pair</a></li><li><a href=#2-initialize-and-deploy>2. Initialize and Deploy</a></li><li><a href=#3-verify-deployment>3. Verify Deployment</a></li></ul></li><li><a href=#best-practices>Best Practices</a><ul><li><a href=#1-security-considerations>1. Security Considerations</a></li><li><a href=#2-state-management>2. State Management</a></li><li><a href=#3-resource-tagging>3. Resource Tagging</a></li></ul></li><li><a href=#advanced-configurations>Advanced Configurations</a><ul><li><a href=#multiple-vms-with-load-balancer>Multiple VMs with Load Balancer</a></li></ul></li><li><a href=#cleanup>Cleanup</a></li><li><a href=#troubleshooting>Troubleshooting</a><ul><li><a href=#common-issues>Common Issues</a></li></ul></li><li><a href=#cost-optimization>Cost Optimization</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#next-steps>Next Steps</a></li><li><a href=#resources>Resources</a></li></ul></nav></div></details></div><div class=post-content><p>Google Cloud Platform (GCP) is one of the leading cloud providers, and Terraform is the de facto standard for Infrastructure as Code (IaC). In this comprehensive guide, you&rsquo;ll learn how to deploy your first virtual machine and VPC in GCP using Terraform.</p><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><p>Before we begin, make sure you have:</p><ul><li><strong>Google Cloud Account</strong> with billing enabled</li><li><strong>Terraform</strong> installed (v1.0+)</li><li><strong>Google Cloud SDK</strong> (<code>gcloud</code>) installed and configured</li><li><strong>Basic understanding</strong> of cloud networking concepts</li></ul><h2 id=setting-up-your-environment>Setting Up Your Environment<a hidden class=anchor aria-hidden=true href=#setting-up-your-environment>#</a></h2><h3 id=1-install-required-tools>1. Install Required Tools<a hidden class=anchor aria-hidden=true href=#1-install-required-tools>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7>7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8>8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Install Terraform (macOS with Homebrew)</span>
</span></span><span class=line><span class=cl>brew install terraform
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Install Google Cloud SDK</span>
</span></span><span class=line><span class=cl>brew install --cask google-cloud-sdk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verify installations</span>
</span></span><span class=line><span class=cl>terraform version
</span></span><span class=line><span class=cl>gcloud version
</span></span></code></pre></td></tr></table></div></div><h3 id=2-authenticate-with-google-cloud>2. Authenticate with Google Cloud<a hidden class=anchor aria-hidden=true href=#2-authenticate-with-google-cloud>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7>7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8>8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9>9</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Login to your Google Cloud account</span>
</span></span><span class=line><span class=cl>gcloud auth login
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set your default project</span>
</span></span><span class=line><span class=cl>gcloud config <span class=nb>set</span> project YOUR_PROJECT_ID
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Enable required APIs</span>
</span></span><span class=line><span class=cl>gcloud services <span class=nb>enable</span> compute.googleapis.com
</span></span><span class=line><span class=cl>gcloud services <span class=nb>enable</span> servicenetworking.googleapis.com
</span></span></code></pre></td></tr></table></div></div><h3 id=3-create-service-account-for-terraform>3. Create Service Account for Terraform<a hidden class=anchor aria-hidden=true href=#3-create-service-account-for-terraform>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create service account</span>
</span></span><span class=line><span class=cl>gcloud iam service-accounts create terraform-sa <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --display-name<span class=o>=</span><span class=s2>&#34;Terraform Service Account&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Grant necessary permissions</span>
</span></span><span class=line><span class=cl>gcloud projects add-iam-policy-binding YOUR_PROJECT_ID <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --member<span class=o>=</span><span class=s2>&#34;serviceAccount:terraform-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --role<span class=o>=</span><span class=s2>&#34;roles/compute.admin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>gcloud projects add-iam-policy-binding YOUR_PROJECT_ID <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --member<span class=o>=</span><span class=s2>&#34;serviceAccount:terraform-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --role<span class=o>=</span><span class=s2>&#34;roles/iam.serviceAccountUser&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create and download key</span>
</span></span><span class=line><span class=cl>gcloud iam service-accounts keys create terraform-key.json <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --iam-account<span class=o>=</span>terraform-sa@YOUR_PROJECT_ID.iam.gserviceaccount.com
</span></span></code></pre></td></tr></table></div></div><h2 id=project-structure>Project Structure<a hidden class=anchor aria-hidden=true href=#project-structure>#</a></h2><p>Let&rsquo;s organize our Terraform code properly:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>terraform</span><span class=o>-</span><span class=n>gcp</span><span class=o>-</span><span class=n>vm</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=n>main</span><span class=o>.</span><span class=n>tf</span>              <span class=c1># Main configuration</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=n>variables</span><span class=o>.</span><span class=n>tf</span>         <span class=c1># Input variables</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=n>outputs</span><span class=o>.</span><span class=n>tf</span>           <span class=c1># Output values</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=n>terraform</span><span class=o>.</span><span class=n>tfvars</span>     <span class=c1># Variable values</span>
</span></span><span class=line><span class=cl><span class=err>└──</span> <span class=n>terraform</span><span class=o>-</span><span class=n>key</span><span class=o>.</span><span class=n>json</span>  <span class=c1># Service account key</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=creating-the-terraform-configuration>Creating the Terraform Configuration<a hidden class=anchor aria-hidden=true href=#creating-the-terraform-configuration>#</a></h2><h3 id=1-provider-configuration-maintf>1. Provider Configuration (<code>main.tf</code>)<a hidden class=anchor aria-hidden=true href=#1-provider-configuration-maintf>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>  1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>  2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>  3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>  4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>  5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>  6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>  7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8>  8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9>  9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10> 10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11> 11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12> 12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13> 13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14> 14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15> 15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16> 16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17> 17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18> 18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19> 19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20> 20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21> 21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22> 22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23> 23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24> 24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25> 25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26> 26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27> 27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28> 28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29> 29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30> 30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31> 31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32> 32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33> 33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34> 34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35> 35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36> 36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37> 37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38> 38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39> 39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40> 40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41> 41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42> 42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43> 43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44> 44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45> 45</a>
</span><span class=lnt id=hl-4-46><a class=lnlinks href=#hl-4-46> 46</a>
</span><span class=lnt id=hl-4-47><a class=lnlinks href=#hl-4-47> 47</a>
</span><span class=lnt id=hl-4-48><a class=lnlinks href=#hl-4-48> 48</a>
</span><span class=lnt id=hl-4-49><a class=lnlinks href=#hl-4-49> 49</a>
</span><span class=lnt id=hl-4-50><a class=lnlinks href=#hl-4-50> 50</a>
</span><span class=lnt id=hl-4-51><a class=lnlinks href=#hl-4-51> 51</a>
</span><span class=lnt id=hl-4-52><a class=lnlinks href=#hl-4-52> 52</a>
</span><span class=lnt id=hl-4-53><a class=lnlinks href=#hl-4-53> 53</a>
</span><span class=lnt id=hl-4-54><a class=lnlinks href=#hl-4-54> 54</a>
</span><span class=lnt id=hl-4-55><a class=lnlinks href=#hl-4-55> 55</a>
</span><span class=lnt id=hl-4-56><a class=lnlinks href=#hl-4-56> 56</a>
</span><span class=lnt id=hl-4-57><a class=lnlinks href=#hl-4-57> 57</a>
</span><span class=lnt id=hl-4-58><a class=lnlinks href=#hl-4-58> 58</a>
</span><span class=lnt id=hl-4-59><a class=lnlinks href=#hl-4-59> 59</a>
</span><span class=lnt id=hl-4-60><a class=lnlinks href=#hl-4-60> 60</a>
</span><span class=lnt id=hl-4-61><a class=lnlinks href=#hl-4-61> 61</a>
</span><span class=lnt id=hl-4-62><a class=lnlinks href=#hl-4-62> 62</a>
</span><span class=lnt id=hl-4-63><a class=lnlinks href=#hl-4-63> 63</a>
</span><span class=lnt id=hl-4-64><a class=lnlinks href=#hl-4-64> 64</a>
</span><span class=lnt id=hl-4-65><a class=lnlinks href=#hl-4-65> 65</a>
</span><span class=lnt id=hl-4-66><a class=lnlinks href=#hl-4-66> 66</a>
</span><span class=lnt id=hl-4-67><a class=lnlinks href=#hl-4-67> 67</a>
</span><span class=lnt id=hl-4-68><a class=lnlinks href=#hl-4-68> 68</a>
</span><span class=lnt id=hl-4-69><a class=lnlinks href=#hl-4-69> 69</a>
</span><span class=lnt id=hl-4-70><a class=lnlinks href=#hl-4-70> 70</a>
</span><span class=lnt id=hl-4-71><a class=lnlinks href=#hl-4-71> 71</a>
</span><span class=lnt id=hl-4-72><a class=lnlinks href=#hl-4-72> 72</a>
</span><span class=lnt id=hl-4-73><a class=lnlinks href=#hl-4-73> 73</a>
</span><span class=lnt id=hl-4-74><a class=lnlinks href=#hl-4-74> 74</a>
</span><span class=lnt id=hl-4-75><a class=lnlinks href=#hl-4-75> 75</a>
</span><span class=lnt id=hl-4-76><a class=lnlinks href=#hl-4-76> 76</a>
</span><span class=lnt id=hl-4-77><a class=lnlinks href=#hl-4-77> 77</a>
</span><span class=lnt id=hl-4-78><a class=lnlinks href=#hl-4-78> 78</a>
</span><span class=lnt id=hl-4-79><a class=lnlinks href=#hl-4-79> 79</a>
</span><span class=lnt id=hl-4-80><a class=lnlinks href=#hl-4-80> 80</a>
</span><span class=lnt id=hl-4-81><a class=lnlinks href=#hl-4-81> 81</a>
</span><span class=lnt id=hl-4-82><a class=lnlinks href=#hl-4-82> 82</a>
</span><span class=lnt id=hl-4-83><a class=lnlinks href=#hl-4-83> 83</a>
</span><span class=lnt id=hl-4-84><a class=lnlinks href=#hl-4-84> 84</a>
</span><span class=lnt id=hl-4-85><a class=lnlinks href=#hl-4-85> 85</a>
</span><span class=lnt id=hl-4-86><a class=lnlinks href=#hl-4-86> 86</a>
</span><span class=lnt id=hl-4-87><a class=lnlinks href=#hl-4-87> 87</a>
</span><span class=lnt id=hl-4-88><a class=lnlinks href=#hl-4-88> 88</a>
</span><span class=lnt id=hl-4-89><a class=lnlinks href=#hl-4-89> 89</a>
</span><span class=lnt id=hl-4-90><a class=lnlinks href=#hl-4-90> 90</a>
</span><span class=lnt id=hl-4-91><a class=lnlinks href=#hl-4-91> 91</a>
</span><span class=lnt id=hl-4-92><a class=lnlinks href=#hl-4-92> 92</a>
</span><span class=lnt id=hl-4-93><a class=lnlinks href=#hl-4-93> 93</a>
</span><span class=lnt id=hl-4-94><a class=lnlinks href=#hl-4-94> 94</a>
</span><span class=lnt id=hl-4-95><a class=lnlinks href=#hl-4-95> 95</a>
</span><span class=lnt id=hl-4-96><a class=lnlinks href=#hl-4-96> 96</a>
</span><span class=lnt id=hl-4-97><a class=lnlinks href=#hl-4-97> 97</a>
</span><span class=lnt id=hl-4-98><a class=lnlinks href=#hl-4-98> 98</a>
</span><span class=lnt id=hl-4-99><a class=lnlinks href=#hl-4-99> 99</a>
</span><span class=lnt id=hl-4-100><a class=lnlinks href=#hl-4-100>100</a>
</span><span class=lnt id=hl-4-101><a class=lnlinks href=#hl-4-101>101</a>
</span><span class=lnt id=hl-4-102><a class=lnlinks href=#hl-4-102>102</a>
</span><span class=lnt id=hl-4-103><a class=lnlinks href=#hl-4-103>103</a>
</span><span class=lnt id=hl-4-104><a class=lnlinks href=#hl-4-104>104</a>
</span><span class=lnt id=hl-4-105><a class=lnlinks href=#hl-4-105>105</a>
</span><span class=lnt id=hl-4-106><a class=lnlinks href=#hl-4-106>106</a>
</span><span class=lnt id=hl-4-107><a class=lnlinks href=#hl-4-107>107</a>
</span><span class=lnt id=hl-4-108><a class=lnlinks href=#hl-4-108>108</a>
</span><span class=lnt id=hl-4-109><a class=lnlinks href=#hl-4-109>109</a>
</span><span class=lnt id=hl-4-110><a class=lnlinks href=#hl-4-110>110</a>
</span><span class=lnt id=hl-4-111><a class=lnlinks href=#hl-4-111>111</a>
</span><span class=lnt id=hl-4-112><a class=lnlinks href=#hl-4-112>112</a>
</span><span class=lnt id=hl-4-113><a class=lnlinks href=#hl-4-113>113</a>
</span><span class=lnt id=hl-4-114><a class=lnlinks href=#hl-4-114>114</a>
</span><span class=lnt id=hl-4-115><a class=lnlinks href=#hl-4-115>115</a>
</span><span class=lnt id=hl-4-116><a class=lnlinks href=#hl-4-116>116</a>
</span><span class=lnt id=hl-4-117><a class=lnlinks href=#hl-4-117>117</a>
</span><span class=lnt id=hl-4-118><a class=lnlinks href=#hl-4-118>118</a>
</span><span class=lnt id=hl-4-119><a class=lnlinks href=#hl-4-119>119</a>
</span><span class=lnt id=hl-4-120><a class=lnlinks href=#hl-4-120>120</a>
</span><span class=lnt id=hl-4-121><a class=lnlinks href=#hl-4-121>121</a>
</span><span class=lnt id=hl-4-122><a class=lnlinks href=#hl-4-122>122</a>
</span><span class=lnt id=hl-4-123><a class=lnlinks href=#hl-4-123>123</a>
</span><span class=lnt id=hl-4-124><a class=lnlinks href=#hl-4-124>124</a>
</span><span class=lnt id=hl-4-125><a class=lnlinks href=#hl-4-125>125</a>
</span><span class=lnt id=hl-4-126><a class=lnlinks href=#hl-4-126>126</a>
</span><span class=lnt id=hl-4-127><a class=lnlinks href=#hl-4-127>127</a>
</span><span class=lnt id=hl-4-128><a class=lnlinks href=#hl-4-128>128</a>
</span><span class=lnt id=hl-4-129><a class=lnlinks href=#hl-4-129>129</a>
</span><span class=lnt id=hl-4-130><a class=lnlinks href=#hl-4-130>130</a>
</span><span class=lnt id=hl-4-131><a class=lnlinks href=#hl-4-131>131</a>
</span><span class=lnt id=hl-4-132><a class=lnlinks href=#hl-4-132>132</a>
</span><span class=lnt id=hl-4-133><a class=lnlinks href=#hl-4-133>133</a>
</span><span class=lnt id=hl-4-134><a class=lnlinks href=#hl-4-134>134</a>
</span><span class=lnt id=hl-4-135><a class=lnlinks href=#hl-4-135>135</a>
</span><span class=lnt id=hl-4-136><a class=lnlinks href=#hl-4-136>136</a>
</span><span class=lnt id=hl-4-137><a class=lnlinks href=#hl-4-137>137</a>
</span><span class=lnt id=hl-4-138><a class=lnlinks href=#hl-4-138>138</a>
</span><span class=lnt id=hl-4-139><a class=lnlinks href=#hl-4-139>139</a>
</span><span class=lnt id=hl-4-140><a class=lnlinks href=#hl-4-140>140</a>
</span><span class=lnt id=hl-4-141><a class=lnlinks href=#hl-4-141>141</a>
</span><span class=lnt id=hl-4-142><a class=lnlinks href=#hl-4-142>142</a>
</span><span class=lnt id=hl-4-143><a class=lnlinks href=#hl-4-143>143</a>
</span><span class=lnt id=hl-4-144><a class=lnlinks href=#hl-4-144>144</a>
</span><span class=lnt id=hl-4-145><a class=lnlinks href=#hl-4-145>145</a>
</span><span class=lnt id=hl-4-146><a class=lnlinks href=#hl-4-146>146</a>
</span><span class=lnt id=hl-4-147><a class=lnlinks href=#hl-4-147>147</a>
</span><span class=lnt id=hl-4-148><a class=lnlinks href=#hl-4-148>148</a>
</span><span class=lnt id=hl-4-149><a class=lnlinks href=#hl-4-149>149</a>
</span><span class=lnt id=hl-4-150><a class=lnlinks href=#hl-4-150>150</a>
</span><span class=lnt id=hl-4-151><a class=lnlinks href=#hl-4-151>151</a>
</span><span class=lnt id=hl-4-152><a class=lnlinks href=#hl-4-152>152</a>
</span><span class=lnt id=hl-4-153><a class=lnlinks href=#hl-4-153>153</a>
</span><span class=lnt id=hl-4-154><a class=lnlinks href=#hl-4-154>154</a>
</span><span class=lnt id=hl-4-155><a class=lnlinks href=#hl-4-155>155</a>
</span><span class=lnt id=hl-4-156><a class=lnlinks href=#hl-4-156>156</a>
</span><span class=lnt id=hl-4-157><a class=lnlinks href=#hl-4-157>157</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=k>terraform</span> {
</span></span><span class=line><span class=cl><span class=n>  required_version</span> <span class=o>=</span><span class=n> &#34;&gt;</span><span class=o>=</span> <span class=m>1</span><span class=p>.</span><span class=m>0</span><span class=err>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>required_providers</span> {
</span></span><span class=line><span class=cl><span class=n>    google</span> <span class=o>=</span> {
</span></span><span class=line><span class=cl><span class=n>      source</span>  <span class=o>=</span> <span class=s2>&#34;hashicorp/google&#34;</span>
</span></span><span class=line><span class=cl><span class=n>      version</span> <span class=o>=</span> <span class=s2>&#34;~&gt; 5.0&#34;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>provider</span> <span class=s2>&#34;google&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  credentials</span> <span class=o>=</span> <span class=k>file</span><span class=p>(</span><span class=s2>&#34;terraform-key.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>  project</span>     <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>project_id</span>
</span></span><span class=line><span class=cl><span class=n>  region</span>      <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>region</span>
</span></span><span class=line><span class=cl><span class=n>  zone</span>        <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>zone</span>
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Create VPC Network
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_network&#34; &#34;vpc_network&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>                    <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>network_name</span>
</span></span><span class=line><span class=cl><span class=n>  auto_create_subnetworks</span> <span class=o>=</span> <span class=kt>false</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>             <span class=o>=</span> <span class=s2>&#34;Custom VPC network for VM deployment&#34;</span>
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Create Subnet
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_subnetwork&#34; &#34;subnet&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>          <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>subnet_name</span>
</span></span><span class=line><span class=cl><span class=n>  ip_cidr_range</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>subnet_cidr</span>
</span></span><span class=line><span class=cl><span class=n>  region</span>        <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>region</span>
</span></span><span class=line><span class=cl><span class=n>  network</span>       <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>   <span class=o>=</span> <span class=s2>&#34;Subnet for VM instances&#34;</span><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>  # Enable private Google access
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>  private_ip_google_access</span> <span class=o>=</span> <span class=kt>true</span>
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Create Firewall Rules
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_firewall&#34; &#34;allow_ssh&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>    <span class=o>=</span> <span class=s2>&#34;${var.network_name}-allow-ssh&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  network</span> <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>allow</span> {
</span></span><span class=line><span class=cl><span class=n>    protocol</span> <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    ports</span>    <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;22&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  source_ranges</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  target_tags</span>   <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ssh-allowed&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>   <span class=o>=</span> <span class=s2>&#34;Allow SSH access from anywhere&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>resource</span> <span class=s2>&#34;google_compute_firewall&#34; &#34;allow_http&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>    <span class=o>=</span> <span class=s2>&#34;${var.network_name}-allow-http&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  network</span> <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>allow</span> {
</span></span><span class=line><span class=cl><span class=n>    protocol</span> <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    ports</span>    <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;80&#34;, &#34;443&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  source_ranges</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  target_tags</span>   <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;web-server&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>   <span class=o>=</span> <span class=s2>&#34;Allow HTTP and HTTPS traffic&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>resource</span> <span class=s2>&#34;google_compute_firewall&#34; &#34;allow_internal&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>    <span class=o>=</span> <span class=s2>&#34;${var.network_name}-allow-internal&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  network</span> <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>allow</span> {
</span></span><span class=line><span class=cl><span class=n>    protocol</span> <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    ports</span>    <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;0-65535&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>allow</span> {
</span></span><span class=line><span class=cl><span class=n>    protocol</span> <span class=o>=</span> <span class=s2>&#34;udp&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    ports</span>    <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;0-65535&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>allow</span> {
</span></span><span class=line><span class=cl><span class=n>    protocol</span> <span class=o>=</span> <span class=s2>&#34;icmp&#34;</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  source_ranges</span> <span class=o>=</span> <span class=p>[</span><span class=k>var</span><span class=p>.</span><span class=k>subnet_cidr</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>   <span class=o>=</span> <span class=s2>&#34;Allow internal communication within the subnet&#34;</span>
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Create External IP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_address&#34; &#34;static_ip&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>         <span class=o>=</span> <span class=s2>&#34;${var.vm_name}-static-ip&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  region</span>       <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>region</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>  <span class=o>=</span> <span class=s2>&#34;Static external IP for VM&#34;</span>
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Create VM Instance
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_instance&#34; &#34;vm_instance&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>         <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>vm_name</span>
</span></span><span class=line><span class=cl><span class=n>  machine_type</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>machine_type</span>
</span></span><span class=line><span class=cl><span class=n>  zone</span>         <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>zone</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  tags</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ssh-allowed&#34;, &#34;web-server&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>boot_disk</span> {
</span></span><span class=line><span class=cl>    <span class=k>initialize_params</span> {
</span></span><span class=line><span class=cl><span class=n>      image</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>vm_image</span>
</span></span><span class=line><span class=cl><span class=n>      size</span>  <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>disk_size</span>
</span></span><span class=line><span class=cl><span class=n>      type</span>  <span class=o>=</span> <span class=s2>&#34;pd-standard&#34;</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>network_interface</span> {
</span></span><span class=line><span class=cl><span class=n>    network</span>    <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl><span class=n>    subnetwork</span> <span class=o>=</span> <span class=k>google_compute_subnetwork</span><span class=p>.</span><span class=k>subnet</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>access_config</span> {
</span></span><span class=line><span class=cl><span class=n>      nat_ip</span> <span class=o>=</span> <span class=k>google_compute_address</span><span class=p>.</span><span class=k>static_ip</span><span class=p>.</span><span class=k>address</span>
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  metadata</span> <span class=o>=</span> {
</span></span><span class=line><span class=cl><span class=n>    ssh-keys</span> <span class=o>=</span> <span class=s2>&#34;${var.ssh_username}:${file(var.ssh_public_key_path)}&#34;</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  metadata_startup_script</span> <span class=o>=</span> <span class=err>&lt;&lt;-</span><span class=k>EOF</span><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>    #!/bin/bash
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>apt</span><span class=err>-</span><span class=k>get</span> <span class=k>update</span>
</span></span><span class=line><span class=cl>    <span class=k>apt</span><span class=err>-</span><span class=k>get</span> <span class=k>install</span> <span class=err>-</span><span class=k>y</span> <span class=k>nginx</span>
</span></span><span class=line><span class=cl>    <span class=k>systemctl</span> <span class=k>start</span> <span class=k>nginx</span>
</span></span><span class=line><span class=cl>    <span class=k>systemctl</span> <span class=k>enable</span> <span class=k>nginx</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;&lt;h1&gt;Hello from ${var.vm_name}!&lt;/h1&gt;&#34;</span> <span class=err>&gt;</span> <span class=err>/</span><span class=k>var</span><span class=err>/</span><span class=k>www</span><span class=err>/</span><span class=k>html</span><span class=err>/</span><span class=k>index</span><span class=p>.</span><span class=k>html</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;&lt;p&gt;Deployed with Terraform on GCP&lt;/p&gt;&#34;</span> <span class=err>&gt;&gt;</span> <span class=err>/</span><span class=k>var</span><span class=err>/</span><span class=k>www</span><span class=err>/</span><span class=k>html</span><span class=err>/</span><span class=k>index</span><span class=p>.</span><span class=k>html</span>
</span></span><span class=line><span class=cl>  <span class=k>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>service_account</span> {
</span></span><span class=line><span class=cl><span class=n>    email</span>  <span class=o>=</span> <span class=k>google_service_account</span><span class=p>.</span><span class=k>vm_service_account</span><span class=p>.</span><span class=k>email</span>
</span></span><span class=line><span class=cl><span class=n>    scopes</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;cloud-platform&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  labels</span> <span class=o>=</span> {
</span></span><span class=line><span class=cl><span class=n>    environment</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>environment</span>
</span></span><span class=line><span class=cl><span class=n>    managed_by</span>  <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Create Service Account for VM
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_service_account&#34; &#34;vm_service_account&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  account_id</span>   <span class=o>=</span> <span class=s2>&#34;${var.vm_name}-sa&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  display_name</span> <span class=o>=</span> <span class=s2>&#34;Service Account for ${var.vm_name}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  description</span>  <span class=o>=</span> <span class=s2>&#34;Service account for VM instance&#34;</span>
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># IAM binding for VM service account
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_project_iam_member&#34; &#34;vm_service_account_binding&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  project</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>project_id</span>
</span></span><span class=line><span class=cl><span class=n>  role</span>    <span class=o>=</span> <span class=s2>&#34;roles/compute.osLogin&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  member</span>  <span class=o>=</span> <span class=s2>&#34;serviceAccount:${google_service_account.vm_service_account.email}&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=2-variables-variablestf>2. Variables (<code>variables.tf</code>)<a hidden class=anchor aria-hidden=true href=#2-variables-variablestf>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span><span class=lnt id=hl-5-26><a class=lnlinks href=#hl-5-26>26</a>
</span><span class=lnt id=hl-5-27><a class=lnlinks href=#hl-5-27>27</a>
</span><span class=lnt id=hl-5-28><a class=lnlinks href=#hl-5-28>28</a>
</span><span class=lnt id=hl-5-29><a class=lnlinks href=#hl-5-29>29</a>
</span><span class=lnt id=hl-5-30><a class=lnlinks href=#hl-5-30>30</a>
</span><span class=lnt id=hl-5-31><a class=lnlinks href=#hl-5-31>31</a>
</span><span class=lnt id=hl-5-32><a class=lnlinks href=#hl-5-32>32</a>
</span><span class=lnt id=hl-5-33><a class=lnlinks href=#hl-5-33>33</a>
</span><span class=lnt id=hl-5-34><a class=lnlinks href=#hl-5-34>34</a>
</span><span class=lnt id=hl-5-35><a class=lnlinks href=#hl-5-35>35</a>
</span><span class=lnt id=hl-5-36><a class=lnlinks href=#hl-5-36>36</a>
</span><span class=lnt id=hl-5-37><a class=lnlinks href=#hl-5-37>37</a>
</span><span class=lnt id=hl-5-38><a class=lnlinks href=#hl-5-38>38</a>
</span><span class=lnt id=hl-5-39><a class=lnlinks href=#hl-5-39>39</a>
</span><span class=lnt id=hl-5-40><a class=lnlinks href=#hl-5-40>40</a>
</span><span class=lnt id=hl-5-41><a class=lnlinks href=#hl-5-41>41</a>
</span><span class=lnt id=hl-5-42><a class=lnlinks href=#hl-5-42>42</a>
</span><span class=lnt id=hl-5-43><a class=lnlinks href=#hl-5-43>43</a>
</span><span class=lnt id=hl-5-44><a class=lnlinks href=#hl-5-44>44</a>
</span><span class=lnt id=hl-5-45><a class=lnlinks href=#hl-5-45>45</a>
</span><span class=lnt id=hl-5-46><a class=lnlinks href=#hl-5-46>46</a>
</span><span class=lnt id=hl-5-47><a class=lnlinks href=#hl-5-47>47</a>
</span><span class=lnt id=hl-5-48><a class=lnlinks href=#hl-5-48>48</a>
</span><span class=lnt id=hl-5-49><a class=lnlinks href=#hl-5-49>49</a>
</span><span class=lnt id=hl-5-50><a class=lnlinks href=#hl-5-50>50</a>
</span><span class=lnt id=hl-5-51><a class=lnlinks href=#hl-5-51>51</a>
</span><span class=lnt id=hl-5-52><a class=lnlinks href=#hl-5-52>52</a>
</span><span class=lnt id=hl-5-53><a class=lnlinks href=#hl-5-53>53</a>
</span><span class=lnt id=hl-5-54><a class=lnlinks href=#hl-5-54>54</a>
</span><span class=lnt id=hl-5-55><a class=lnlinks href=#hl-5-55>55</a>
</span><span class=lnt id=hl-5-56><a class=lnlinks href=#hl-5-56>56</a>
</span><span class=lnt id=hl-5-57><a class=lnlinks href=#hl-5-57>57</a>
</span><span class=lnt id=hl-5-58><a class=lnlinks href=#hl-5-58>58</a>
</span><span class=lnt id=hl-5-59><a class=lnlinks href=#hl-5-59>59</a>
</span><span class=lnt id=hl-5-60><a class=lnlinks href=#hl-5-60>60</a>
</span><span class=lnt id=hl-5-61><a class=lnlinks href=#hl-5-61>61</a>
</span><span class=lnt id=hl-5-62><a class=lnlinks href=#hl-5-62>62</a>
</span><span class=lnt id=hl-5-63><a class=lnlinks href=#hl-5-63>63</a>
</span><span class=lnt id=hl-5-64><a class=lnlinks href=#hl-5-64>64</a>
</span><span class=lnt id=hl-5-65><a class=lnlinks href=#hl-5-65>65</a>
</span><span class=lnt id=hl-5-66><a class=lnlinks href=#hl-5-66>66</a>
</span><span class=lnt id=hl-5-67><a class=lnlinks href=#hl-5-67>67</a>
</span><span class=lnt id=hl-5-68><a class=lnlinks href=#hl-5-68>68</a>
</span><span class=lnt id=hl-5-69><a class=lnlinks href=#hl-5-69>69</a>
</span><span class=lnt id=hl-5-70><a class=lnlinks href=#hl-5-70>70</a>
</span><span class=lnt id=hl-5-71><a class=lnlinks href=#hl-5-71>71</a>
</span><span class=lnt id=hl-5-72><a class=lnlinks href=#hl-5-72>72</a>
</span><span class=lnt id=hl-5-73><a class=lnlinks href=#hl-5-73>73</a>
</span><span class=lnt id=hl-5-74><a class=lnlinks href=#hl-5-74>74</a>
</span><span class=lnt id=hl-5-75><a class=lnlinks href=#hl-5-75>75</a>
</span><span class=lnt id=hl-5-76><a class=lnlinks href=#hl-5-76>76</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;project_id&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;GCP Project ID&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;region&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;GCP Region&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;us-central1&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;zone&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;GCP Zone&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;us-central1-a&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;network_name&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Name of the VPC network&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;my-vpc-network&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;subnet_name&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Name of the subnet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;my-subnet&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;subnet_cidr&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;CIDR range for the subnet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;10.0.1.0/24&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;vm_name&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Name of the VM instance&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;my-vm-instance&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;machine_type&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Machine type for the VM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;e2-micro&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;vm_image&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Image for the VM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;ubuntu-os-cloud/ubuntu-2204-lts&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;disk_size&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Size of the boot disk in GB&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>number</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=m>20</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;ssh_username&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;SSH username&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;terraform-user&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;ssh_public_key_path&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Path to SSH public key&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;~/.ssh/id_rsa.pub&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>variable</span> <span class=s2>&#34;environment&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Environment tag&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
</span></span><span class=line><span class=cl><span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;development&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=3-outputs-outputstf>3. Outputs (<code>outputs.tf</code>)<a hidden class=anchor aria-hidden=true href=#3-outputs-outputstf>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span><span class=lnt id=hl-6-24><a class=lnlinks href=#hl-6-24>24</a>
</span><span class=lnt id=hl-6-25><a class=lnlinks href=#hl-6-25>25</a>
</span><span class=lnt id=hl-6-26><a class=lnlinks href=#hl-6-26>26</a>
</span><span class=lnt id=hl-6-27><a class=lnlinks href=#hl-6-27>27</a>
</span><span class=lnt id=hl-6-28><a class=lnlinks href=#hl-6-28>28</a>
</span><span class=lnt id=hl-6-29><a class=lnlinks href=#hl-6-29>29</a>
</span><span class=lnt id=hl-6-30><a class=lnlinks href=#hl-6-30>30</a>
</span><span class=lnt id=hl-6-31><a class=lnlinks href=#hl-6-31>31</a>
</span><span class=lnt id=hl-6-32><a class=lnlinks href=#hl-6-32>32</a>
</span><span class=lnt id=hl-6-33><a class=lnlinks href=#hl-6-33>33</a>
</span><span class=lnt id=hl-6-34><a class=lnlinks href=#hl-6-34>34</a>
</span><span class=lnt id=hl-6-35><a class=lnlinks href=#hl-6-35>35</a>
</span><span class=lnt id=hl-6-36><a class=lnlinks href=#hl-6-36>36</a>
</span><span class=lnt id=hl-6-37><a class=lnlinks href=#hl-6-37>37</a>
</span><span class=lnt id=hl-6-38><a class=lnlinks href=#hl-6-38>38</a>
</span><span class=lnt id=hl-6-39><a class=lnlinks href=#hl-6-39>39</a>
</span><span class=lnt id=hl-6-40><a class=lnlinks href=#hl-6-40>40</a>
</span><span class=lnt id=hl-6-41><a class=lnlinks href=#hl-6-41>41</a>
</span><span class=lnt id=hl-6-42><a class=lnlinks href=#hl-6-42>42</a>
</span><span class=lnt id=hl-6-43><a class=lnlinks href=#hl-6-43>43</a>
</span><span class=lnt id=hl-6-44><a class=lnlinks href=#hl-6-44>44</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;vpc_network_name&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Name of the VPC network&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;vpc_network_id&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;ID of the VPC network&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;subnet_name&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Name of the subnet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_subnetwork</span><span class=p>.</span><span class=k>subnet</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;subnet_cidr&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;CIDR range of the subnet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_subnetwork</span><span class=p>.</span><span class=k>subnet</span><span class=p>.</span><span class=k>ip_cidr_range</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;vm_name&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Name of the VM instance&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_instance</span><span class=p>.</span><span class=k>vm_instance</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;vm_internal_ip&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;Internal IP address of the VM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_instance</span><span class=p>.</span><span class=k>vm_instance</span><span class=p>.</span><span class=k>network_interface</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=k>network_ip</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;vm_external_ip&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;External IP address of the VM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=k>google_compute_address</span><span class=p>.</span><span class=k>static_ip</span><span class=p>.</span><span class=k>address</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;ssh_connection_command&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;SSH command to connect to the VM&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=s2>&#34;ssh ${var.ssh_username}@${google_compute_address.static_ip.address}&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>output</span> <span class=s2>&#34;web_url&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;URL to access the web server&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  value</span>       <span class=o>=</span> <span class=s2>&#34;http://${google_compute_address.static_ip.address}&#34;</span>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=4-variable-values-terraformtfvars>4. Variable Values (<code>terraform.tfvars</code>)<a hidden class=anchor aria-hidden=true href=#4-variable-values-terraformtfvars>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=n>project_id</span>           <span class=o>=</span> <span class=s2>&#34;your-gcp-project-id&#34;</span>
</span></span><span class=line><span class=cl><span class=n>region</span>              <span class=o>=</span> <span class=s2>&#34;us-central1&#34;</span>
</span></span><span class=line><span class=cl><span class=n>zone</span>                <span class=o>=</span> <span class=s2>&#34;us-central1-a&#34;</span>
</span></span><span class=line><span class=cl><span class=n>network_name</span>        <span class=o>=</span> <span class=s2>&#34;terraform-vpc&#34;</span>
</span></span><span class=line><span class=cl><span class=n>subnet_name</span>         <span class=o>=</span> <span class=s2>&#34;terraform-subnet&#34;</span>
</span></span><span class=line><span class=cl><span class=n>subnet_cidr</span>         <span class=o>=</span> <span class=s2>&#34;10.0.1.0/24&#34;</span>
</span></span><span class=line><span class=cl><span class=n>vm_name</span>             <span class=o>=</span> <span class=s2>&#34;terraform-vm&#34;</span>
</span></span><span class=line><span class=cl><span class=n>machine_type</span>        <span class=o>=</span> <span class=s2>&#34;e2-micro&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ssh_username</span>        <span class=o>=</span> <span class=s2>&#34;terraform-user&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ssh_public_key_path</span> <span class=o>=</span> <span class=s2>&#34;~/.ssh/id_rsa.pub&#34;</span>
</span></span><span class=line><span class=cl><span class=n>environment</span>         <span class=o>=</span> <span class=s2>&#34;development&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=deploying-the-infrastructure>Deploying the Infrastructure<a hidden class=anchor aria-hidden=true href=#deploying-the-infrastructure>#</a></h2><h3 id=1-generate-ssh-key-pair>1. Generate SSH Key Pair<a hidden class=anchor aria-hidden=true href=#1-generate-ssh-key-pair>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Generate SSH key pair if you don&#39;t have one</span>
</span></span><span class=line><span class=cl>ssh-keygen -t rsa -b <span class=m>4096</span> -C <span class=s2>&#34;your-email@example.com&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-initialize-and-deploy>2. Initialize and Deploy<a hidden class=anchor aria-hidden=true href=#2-initialize-and-deploy>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a>
</span><span class=lnt id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a>
</span><span class=lnt id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a>
</span><span class=lnt id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a>
</span><span class=lnt id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a>
</span><span class=lnt id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Initialize Terraform</span>
</span></span><span class=line><span class=cl>terraform init
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Validate configuration</span>
</span></span><span class=line><span class=cl>terraform validate
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Plan the deployment</span>
</span></span><span class=line><span class=cl>terraform plan
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Apply the configuration</span>
</span></span><span class=line><span class=cl>terraform apply
</span></span></code></pre></td></tr></table></div></div><h3 id=3-verify-deployment>3. Verify Deployment<a hidden class=anchor aria-hidden=true href=#3-verify-deployment>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1>1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2>2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3>3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4>4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5>5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6>6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7>7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8>8</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check the outputs</span>
</span></span><span class=line><span class=cl>terraform output
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># SSH into the VM</span>
</span></span><span class=line><span class=cl>ssh terraform-user@<span class=k>$(</span>terraform output -raw vm_external_ip<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Test the web server</span>
</span></span><span class=line><span class=cl>curl http://<span class=k>$(</span>terraform output -raw vm_external_ip<span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=best-practices>Best Practices<a hidden class=anchor aria-hidden=true href=#best-practices>#</a></h2><h3 id=1-security-considerations>1. Security Considerations<a hidden class=anchor aria-hidden=true href=#1-security-considerations>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a>
</span><span class=lnt id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a>
</span><span class=lnt id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a>
</span><span class=lnt id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a>
</span><span class=lnt id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a>
</span><span class=lnt id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a>
</span><span class=lnt id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a>
</span><span class=lnt id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a>
</span><span class=lnt id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a>
</span><span class=lnt id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a>
</span><span class=lnt id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a>
</span><span class=lnt id=hl-11-12><a class=lnlinks href=#hl-11-12>12</a>
</span><span class=lnt id=hl-11-13><a class=lnlinks href=#hl-11-13>13</a>
</span><span class=lnt id=hl-11-14><a class=lnlinks href=#hl-11-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=c1># Use more restrictive firewall rules
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_firewall&#34; &#34;allow_ssh_restricted&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>    <span class=o>=</span> <span class=s2>&#34;${var.network_name}-allow-ssh-restricted&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  network</span> <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>allow</span> {
</span></span><span class=line><span class=cl><span class=n>    protocol</span> <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    ports</span>    <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;22&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  }<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>  # Restrict to your IP address
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>  source_ranges</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;YOUR_IP_ADDRESS/32&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  target_tags</span>   <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ssh-allowed&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=2-state-management>2. State Management<a hidden class=anchor aria-hidden=true href=#2-state-management>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a class=lnlinks href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a class=lnlinks href=#hl-12-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=k>terraform</span> {
</span></span><span class=line><span class=cl>  <span class=k>backend</span> <span class=s2>&#34;gcs&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>    bucket</span> <span class=o>=</span> <span class=s2>&#34;your-terraform-state-bucket&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    prefix</span> <span class=o>=</span> <span class=s2>&#34;terraform/state&#34;</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h3 id=3-resource-tagging>3. Resource Tagging<a hidden class=anchor aria-hidden=true href=#3-resource-tagging>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1> 1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2> 2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3> 3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4> 4</a>
</span><span class=lnt id=hl-13-5><a class=lnlinks href=#hl-13-5> 5</a>
</span><span class=lnt id=hl-13-6><a class=lnlinks href=#hl-13-6> 6</a>
</span><span class=lnt id=hl-13-7><a class=lnlinks href=#hl-13-7> 7</a>
</span><span class=lnt id=hl-13-8><a class=lnlinks href=#hl-13-8> 8</a>
</span><span class=lnt id=hl-13-9><a class=lnlinks href=#hl-13-9> 9</a>
</span><span class=lnt id=hl-13-10><a class=lnlinks href=#hl-13-10>10</a>
</span><span class=lnt id=hl-13-11><a class=lnlinks href=#hl-13-11>11</a>
</span><span class=lnt id=hl-13-12><a class=lnlinks href=#hl-13-12>12</a>
</span><span class=lnt id=hl-13-13><a class=lnlinks href=#hl-13-13>13</a>
</span><span class=lnt id=hl-13-14><a class=lnlinks href=#hl-13-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=k>locals</span> {
</span></span><span class=line><span class=cl><span class=n>  common_labels</span> <span class=o>=</span> {
</span></span><span class=line><span class=cl><span class=n>    environment</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>environment</span>
</span></span><span class=line><span class=cl><span class=n>    project</span>     <span class=o>=</span> <span class=s2>&#34;terraform-gcp-demo&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    managed_by</span>  <span class=o>=</span> <span class=s2>&#34;terraform&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    created_by</span>  <span class=o>=</span> <span class=s2>&#34;diogo-guedes&#34;</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>resource</span> <span class=s2>&#34;google_compute_instance&#34; &#34;vm_instance&#34;</span> {<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>  # ... other configuration ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>  <span class=n>labels</span> <span class=o>=</span> <span class=k>local</span><span class=p>.</span><span class=k>common_labels</span>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h2 id=advanced-configurations>Advanced Configurations<a hidden class=anchor aria-hidden=true href=#advanced-configurations>#</a></h2><h3 id=multiple-vms-with-load-balancer>Multiple VMs with Load Balancer<a hidden class=anchor aria-hidden=true href=#multiple-vms-with-load-balancer>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1> 1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2> 2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3> 3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4> 4</a>
</span><span class=lnt id=hl-14-5><a class=lnlinks href=#hl-14-5> 5</a>
</span><span class=lnt id=hl-14-6><a class=lnlinks href=#hl-14-6> 6</a>
</span><span class=lnt id=hl-14-7><a class=lnlinks href=#hl-14-7> 7</a>
</span><span class=lnt id=hl-14-8><a class=lnlinks href=#hl-14-8> 8</a>
</span><span class=lnt id=hl-14-9><a class=lnlinks href=#hl-14-9> 9</a>
</span><span class=lnt id=hl-14-10><a class=lnlinks href=#hl-14-10>10</a>
</span><span class=lnt id=hl-14-11><a class=lnlinks href=#hl-14-11>11</a>
</span><span class=lnt id=hl-14-12><a class=lnlinks href=#hl-14-12>12</a>
</span><span class=lnt id=hl-14-13><a class=lnlinks href=#hl-14-13>13</a>
</span><span class=lnt id=hl-14-14><a class=lnlinks href=#hl-14-14>14</a>
</span><span class=lnt id=hl-14-15><a class=lnlinks href=#hl-14-15>15</a>
</span><span class=lnt id=hl-14-16><a class=lnlinks href=#hl-14-16>16</a>
</span><span class=lnt id=hl-14-17><a class=lnlinks href=#hl-14-17>17</a>
</span><span class=lnt id=hl-14-18><a class=lnlinks href=#hl-14-18>18</a>
</span><span class=lnt id=hl-14-19><a class=lnlinks href=#hl-14-19>19</a>
</span><span class=lnt id=hl-14-20><a class=lnlinks href=#hl-14-20>20</a>
</span><span class=lnt id=hl-14-21><a class=lnlinks href=#hl-14-21>21</a>
</span><span class=lnt id=hl-14-22><a class=lnlinks href=#hl-14-22>22</a>
</span><span class=lnt id=hl-14-23><a class=lnlinks href=#hl-14-23>23</a>
</span><span class=lnt id=hl-14-24><a class=lnlinks href=#hl-14-24>24</a>
</span><span class=lnt id=hl-14-25><a class=lnlinks href=#hl-14-25>25</a>
</span><span class=lnt id=hl-14-26><a class=lnlinks href=#hl-14-26>26</a>
</span><span class=lnt id=hl-14-27><a class=lnlinks href=#hl-14-27>27</a>
</span><span class=lnt id=hl-14-28><a class=lnlinks href=#hl-14-28>28</a>
</span><span class=lnt id=hl-14-29><a class=lnlinks href=#hl-14-29>29</a>
</span><span class=lnt id=hl-14-30><a class=lnlinks href=#hl-14-30>30</a>
</span><span class=lnt id=hl-14-31><a class=lnlinks href=#hl-14-31>31</a>
</span><span class=lnt id=hl-14-32><a class=lnlinks href=#hl-14-32>32</a>
</span><span class=lnt id=hl-14-33><a class=lnlinks href=#hl-14-33>33</a>
</span><span class=lnt id=hl-14-34><a class=lnlinks href=#hl-14-34>34</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=c1># Instance Template
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_instance_template&#34; &#34;web_template&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name_prefix</span>  <span class=o>=</span> <span class=s2>&#34;web-template-&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  machine_type</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>machine_type</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>disk</span> {
</span></span><span class=line><span class=cl><span class=n>    source_image</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>vm_image</span>
</span></span><span class=line><span class=cl><span class=n>    auto_delete</span>  <span class=o>=</span> <span class=kt>true</span>
</span></span><span class=line><span class=cl><span class=n>    boot</span>         <span class=o>=</span> <span class=kt>true</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>network_interface</span> {
</span></span><span class=line><span class=cl><span class=n>    network</span>    <span class=o>=</span> <span class=k>google_compute_network</span><span class=p>.</span><span class=k>vpc_network</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl><span class=n>    subnetwork</span> <span class=o>=</span> <span class=k>google_compute_subnetwork</span><span class=p>.</span><span class=k>subnet</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  metadata_startup_script</span> <span class=o>=</span> <span class=k>file</span><span class=p>(</span><span class=s2>&#34;startup-script.sh&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>lifecycle</span> {
</span></span><span class=line><span class=cl><span class=n>    create_before_destroy</span> <span class=o>=</span> <span class=kt>true</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}<span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># Managed Instance Group
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>resource</span> <span class=s2>&#34;google_compute_instance_group_manager&#34; &#34;web_igm&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>               <span class=o>=</span> <span class=s2>&#34;web-igm&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  base_instance_name</span> <span class=o>=</span> <span class=s2>&#34;web&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  zone</span>               <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>zone</span>
</span></span><span class=line><span class=cl><span class=n>  target_size</span>        <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>version</span> {
</span></span><span class=line><span class=cl><span class=n>    instance_template</span> <span class=o>=</span> <span class=k>google_compute_instance_template</span><span class=p>.</span><span class=k>web_template</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><h2 id=cleanup>Cleanup<a hidden class=anchor aria-hidden=true href=#cleanup>#</a></h2><p>When you&rsquo;re done testing, clean up the resources:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Destroy all resources</span>
</span></span><span class=line><span class=cl>terraform destroy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Confirm by typing &#39;yes&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=troubleshooting>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting>#</a></h2><h3 id=common-issues>Common Issues<a hidden class=anchor aria-hidden=true href=#common-issues>#</a></h3><ol><li><p><strong>Authentication Errors</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Re-authenticate</span>
</span></span><span class=line><span class=cl>gcloud auth application-default login
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>API Not Enabled</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Enable required APIs</span>
</span></span><span class=line><span class=cl>gcloud services <span class=nb>enable</span> compute.googleapis.com
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Insufficient Permissions</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>2</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check your permissions</span>
</span></span><span class=line><span class=cl>gcloud projects get-iam-policy YOUR_PROJECT_ID
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=cost-optimization>Cost Optimization<a hidden class=anchor aria-hidden=true href=#cost-optimization>#</a></h2><ul><li>Use <strong>e2-micro</strong> instances for testing (eligible for free tier)</li><li>Set up <strong>budget alerts</strong> in GCP Console</li><li>Use <strong>preemptible instances</strong> for non-critical workloads</li><li>Implement <strong>auto-shutdown</strong> for development environments</li></ul><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>You&rsquo;ve successfully deployed your first virtual machine and VPC in Google Cloud Platform using Terraform! This foundation gives you:</p><ul><li><strong>Reproducible Infrastructure</strong> - Deploy identical environments</li><li><strong>Version Control</strong> - Track infrastructure changes</li><li><strong>Collaboration</strong> - Share infrastructure code with your team</li><li><strong>Scalability</strong> - Easily add more resources</li></ul><h2 id=next-steps>Next Steps<a hidden class=anchor aria-hidden=true href=#next-steps>#</a></h2><ul><li>Explore <strong>Terraform modules</strong> for reusable components</li><li>Implement <strong>CI/CD pipelines</strong> for infrastructure deployment</li><li>Learn about <strong>GCP networking</strong> features like Cloud NAT and VPN</li><li>Set up <strong>monitoring and logging</strong> with Cloud Operations</li></ul><h2 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2><ul><li><a href=https://registry.terraform.io/providers/hashicorp/google/latest/docs>Terraform GCP Provider Documentation</a></li><li><a href=https://cloud.google.com/architecture>Google Cloud Architecture Center</a></li><li><a href=https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html>Terraform Best Practices</a></li><li><a href=https://cloud.google.com/free>GCP Free Tier</a></li></ul><p>Happy terraforming! 🚀</p><hr><p><em>Have questions or suggestions? Feel free to reach out on <a href=https://www.linkedin.com/in/diogo-guedes11/>LinkedIn</a> or check out more DevOps content on this blog!</em></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/terraform/>Terraform</a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/gcp/>Gcp</a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/google-cloud/>Google-Cloud</a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/infrastructure-as-code/>Infrastructure-as-Code</a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/vpc/>Vpc</a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/virtual-machine/>Virtual-Machine</a></li><li><a href=http://localhost:1314/gh-deployment-workflow-/tags/devops/>Devops</a></li></ul><nav class=paginav><a class=next href=http://localhost:1314/gh-deployment-workflow-/posts/deploy-papermod-hugo/><span class=title>Next »</span><br><span>How to Deploy PaperMod Theme in Hugo</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on x" href="https://x.com/intent/tweet/?text=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform&amp;url=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f&amp;hashtags=terraform%2cgcp%2cgoogle-cloud%2cinfrastructure-as-code%2cvpc%2cvirtual-machine%2cdevops"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f&amp;title=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform&amp;summary=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform&amp;source=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f&title=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on whatsapp" href="https://api.whatsapp.com/send?text=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform%20-%20http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on telegram" href="https://telegram.me/share/url?text=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform&amp;url=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploy Your First VM and VPC in Google Cloud with Terraform on ycombinator" href="https://news.ycombinator.com/submitlink?t=Deploy%20Your%20First%20VM%20and%20VPC%20in%20Google%20Cloud%20with%20Terraform&u=http%3a%2f%2flocalhost%3a1314%2fgh-deployment-workflow-%2fposts%2fterraform-gcp-vm-vpc%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1314/gh-deployment-workflow-/>Diogo Guedes | DevOps Engineer</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>